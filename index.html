<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Dona con Gabriel</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <header>
    <div class="container d-flex justify-content-between align-items-start mt-2">
      <div class="logo">
        <img src="images/the-g.png" alt="">
      </div>
      <nav class="d-flex align-items-center">
        <a href="https://wa.me/5215522342376&text=Mensaje%para%mostrar"><i class="fab fa-whatsapp"></i><span>+52 1 55 30 34 49 52</span></a>
        <!--<a href="#"><i class="fab fa-facebook-f"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
        <button class="btn btn-sm" type="button">DONAR CANTIDAD</button></p>
        <div class="button-a"></div>-->
      </nav>
    </div>
  </header>
  <section class="hero">
    <div class="container">
      <h1 class="display-4 text-uppercase">Hola, soy Gabriel y soy un wish granter</h1>
      <p class="lead">Con la ayuda de: <img src="images/mawmx.png"></p>
      <form class="form-inline">
        <div class="form-group mb-2">
            <div class="mar_qua">Introduce cantidad</div>
          <input class="form-control form-control-lg" placeholder="Cantidad" type="text" id="quantity">
        </div>
        <button class="btn btn-lg btn-maw" type="button">DONAR</button>
      </form>
      <div class="button-b"></div>
    </div>
  </section>
  <section class="total bg-blue">
    <div class="container pt-3 pb-3">
      <div class="row align-items-center">
        <div class="col-md-4">
          <div class="d-flex align-items-center text-center">
            <div class="flex-fill total-donado">
              <p><b>$<span class="money"></span></b></p>
              <p><span>Total donado</span></p>
            </div>
            <div class="lead">+</div>
            <div class="flex-fill total-donado">
              <p><b>$<span class="money"></span></b></p>
              <p><span>Donado por Gabriel</span></p>
            </div>
          </div>
        </div>
        <div class="col-md-8">
          <div class="deseos">
            <div class="d-flex">
              <div class="flex-fill"><span>33%</span></div>
              <div class="flex-fill"><span>66%</span></div>
              <div class="flex-fill"><span>100%</span></div>
            </div>
            <div class="progress">
              <div id="progress" class="progress-bar" role="progressbar" style aria-valuenow="28" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
            <div class="faltan">Falta <b>$<span id="percentage">100</span></b> MXN para llegar a <b>$60,000.00 MXN </b></div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <section class="main">
    <div class="container">
      <!-- icon | icon | icon -->
      <div class="row text-center maw-icons">
        <div class="col-sm-4">
          <!-- <drupal-entity alt="Icono donación" data-caption="Icono donación" data-embed-button="media" data-entity-embed-display="view_mode:media.large" data-entity-embed-display-settings="{&quot;link_url&quot;:&quot;&quot;,&quot;link_url_target&quot;:0}" data-entity-type="media" data-entity-uuid="b66a2fa9-b18f-4871-99c0-ba0e6e4b7e54" title="Icono donación"></drupal-entity> -->
          <img src="images/i_donar.png">
          <p class="lead">Por cada peso que dones, Gabriel donará otro.</p>
        </div>
        <div class="col-sm-4">
          <!-- <drupal-entity alt="Icono meta" data-embed-button="media" data-entity-embed-display="view_mode:media.large" data-entity-embed-display-settings="{&quot;link_url&quot;:&quot;&quot;,&quot;link_url_target&quot;:0}" data-entity-type="media" data-entity-uuid="f6704035-f28d-4204-8992-e67c4ba53026" title="Icono meta"></drupal-entity> -->
          <img src="images/i_meta.png">
          <p class="lead">Nuestra meta es cumplir deseos.</p>
        </div>
        <div class="col-sm-4">
          <!-- <drupal-entity alt="Icono estrella" data-caption="Icono estrella" data-embed-button="media" data-entity-embed-display="view_mode:media.large" data-entity-embed-display-settings="{&quot;link_url&quot;:&quot;&quot;,&quot;link_url_target&quot;:0}" data-entity-type="media" data-entity-uuid="8b467436-64ab-4c2c-ae85-795b917a54a8" title="Icono estrella"></drupal-entity> -->
          <img src="images/i_deseo.png">
          <p class="lead">¡Llegemos a 60,000 pesos para cumplir deseos!</p>
        </div>
      </div>
      <!-- video | content -->
      <div class="row mb-5">
        <div class="col-sm-6">
          <!--<div class="embed-responsive embed-responsive-16by9">
            <iframe class="embed-responsive-item" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/rAC_4BvX9Eo" width="560"></iframe>
          </div>-->
          <div class="logo_temp">
            <img src="images/the-g.png" alt="">
          </div>
        </div>
        <div class="col-sm-6">
          <h2 class="text-uppercase">Hola, soy Gabriel y soy un wish granter</h2>
          <p class="glow">Como parte de mi <b>preparación para mi Bar Mitzvah</b>, me propuse encontrar un <b>“mitzvah project”</b> que ayudara directamente a gente a tener una mejor calidad de vida.</p>
          <p class="glow">Encontré a Make-A-Wish, que cumpliendo deseos, transforma vidas; <b>“Cuando un deseo se hace realidad, trae fortaleza, esperanza y transformación”</b>.</p>
          <p class="glow">Ayúdame a cumplir los deseos de niños con enfermedades críticas, para darles fortaleza y alegrías, en medio de su lucha por la vida.</p>
          <p class="glow lead"><b>¡Ayúdame a cumplir deseos!</b></p>
          <form class="form-inline">
            <div class="form-group mb-2">
                <div class="mar_qua">Introduce cantidad</div>
              <input class="form-control form-control-lg" type="text" id="quantity"  placeholder="Cantidad">
            </div>
            <button class="btn btn-lg btn-maw" type="button">DONAR</button>
          </form>
          <div class="button-c"></div>
          <nav class="d-flex justify-content-end social align-items-center">
            <!--<span>Compartir</span>
            <a><i class="fab fa-facebook-square"></i></a>
            <a><i class="fab fa-twitter-square"></i></a>-->
          </nav>
        </div>
      </div>
    </div>
  </section>
  <footer class="bottom bg-blue">
    <div class="container text-center">
      <img src="images/mawmx.png">
      <p class="lead">Cumplir un deseo puede cambiar la forma en que un niño enfrenta su enfermedad. Descubre más en <a href="http://www.makeawish.org.mx/">Make-A-Wish</a>.</p>
    </div>
  </footer>
  <footer class="footer">
    <div class="container">
      <div class="d-flex justify-content-between">
        <div class="">México | 2019</div>
        <div class="">design & developed by <a href="https://steed.mx/es">steed.mx</a></div>
      </div>
    </div>
  </footer>
  <div id="overlay">
    <div id="overlay-close"></div>
    <div class="overlay-content">
      Tu pago se verá reflejado y te llegará un mail de parte de Paypal.
    </div>  
  </div>
  <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
  <script src="https://www.paypal.com/sdk/js?currency=MXN&client-id=ASJsNqgydhmklf0sXGXM9wzms8Xp4H3ZeRTja1JnBsy-iUjJYd8KJ2TuGEM4FOZpx_IZB-WQJDmfxFWH"></script>
  <script>
  var totalAmount = 0;
  
  document.getElementById("overlay-close").addEventListener("click", closeModal);

  function getTotal() {
    var today = moment().format();
    fetch("https://api.paypal.com/v1/reporting/transactions/?start_date=2019-03-20T00:00:00-0700&end_date=2019-04-16T23:59:59-0700&fields=all&page_size=100&page=1",
    {
      method: "get",
      headers: {
        "content-type": "application/json",
        "authorization": "Bearer A21AAGk5VZxlCW8klfeD-tvHwebbPec5bitx3Ttvs4fTzdwPYptq_txOnFHsYhOKTgqMUOH8JwCAddQYPi8_7Iq6fhobyC4cw"
      }
    })
      .then(function(response) {
        return response.json();
      })
      .then(function(transaction) {
        sumTransactions(transaction.transaction_details);
        console.log(transaction.transaction_details);
      });
  }

  function sumDonation() {
    var donation = parseInt(document.getElementById('quantity').value);
    setNumbers(totalAmount + donation);
    document.getElementById("overlay").className = "open";
  }
  
  function closeModal() {
    document.getElementById("overlay").classList.remove("open");
  }

  function sumTransactions(transactions){
    for(var i=0 ; i<transactions.length ; i++) {
      totalAmount = totalAmount + parseFloat(transactions[i].transaction_info.transaction_amount.value);
      console.log(parseFloat(transactions[i].transaction_info.transaction_amount.value));
    }
    setNumbers(totalAmount);
  }

  function setNumbers(totalAmount) {
    console.log(typeof totalAmount);
    var goal = 60000;
    var money = document.getElementsByClassName('money');
    var progress = ((totalAmount*2)*100)/goal;
    var percentage = goal-(totalAmount*2);
    document.getElementById('progress').style.width = parseInt(progress).toString()+'%';
    document.getElementById('percentage').innerHTML = percentage.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
    for (var m = 0; m < money.length; m++) {
      money[m].innerHTML = totalAmount.toFixed(2).toString();
    }
    if (progress <= 33) {
      document.getElementById('progress').style.backgroundColor = '#b71c1c';
    } else if (progress >= 34 && progress <= 66) {
      document.getElementById('progress').style.backgroundColor = '#ff6f00';
    }
  }

  (function ($) {
    getTotal();
    [
      {
        container: ".button-a",
        style: {
          label:  "pay",
          shape:  "pill",
          fundingicons: false,
          layout: "horizontal",
          tagline: false,
          width: 114,
          height: 32
        }
      },
      {
        container: ".button-b",
        style: {
          label:  "pay",
          shape:  "pill",
          fundingicons: false,
          layout: "horizontal",
          tagline: false,
          width: 172,
          height: 46
        }
      },
      {
        container: ".button-c",
        style: {
          label:  "pay",
          shape:  "pill",
          fundingicons: false,
          layout: "horizontal",
          tagline: false,
          width: 172,
          height: 46
        }
      }
    ].forEach(function(button) {
      paypal.Buttons({
      createOrder: function(data, actions) {
        return actions.order.create({
          purchase_units: [{
            amount: {
              currency_code: "MXN",
              value: document.getElementById('quantity').value,
            }
          }]
        });
      },
      onApprove: function(data, actions) {
        sumDonation();
        return actions.order.capture().then(function(details) {
          return fetch('/paypal-transaction-complete', {
            method: 'post',
            headers: {
              'content-type': 'application/json'
            },
            body: JSON.stringify({
              orderID: data.orderID
            })
          });
          
        });
      },
      // commit: true,
      style: button.style
    }).render(button.container);
    // }).render(element);
    });
  })(jQuery);
</script>
</body>
</html>